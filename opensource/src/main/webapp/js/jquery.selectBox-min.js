(function(d){var j=this.SelectBox=function(a,c){if(a instanceof jQuery)if(a.length>0)a=a[0];else return;this.typeTimer=null;this.typeSearch="";this.isMac=navigator.platform.match(/mac/i);c="object"===typeof c?c:{};this.selectElement=a;if(!c.mobile&&navigator.userAgent.match(/iPad|iPhone|Android|IEMobile|BlackBerry/i))return false;if("select"!==a.tagName.toLowerCase())return false;this.init(c)};j.prototype.version="1.2.0";j.prototype.init=function(a){var c=d(this.selectElement);if(c.data("selectBox-control"))return false;
var b=d('<a class="selectBox" />'),e=c.attr("multiple")||parseInt(c.attr("size"))>1,f=a||{},g=parseInt(c.attr("tabindex"))||0,h=this;b.width(c.outerWidth()).addClass(c.attr("class")).attr("title",c.attr("title")||"").attr("tabindex",g).css("display","inline-block").bind("focus.selectBox",function(){this!==document.activeElement&&document.body!==document.activeElement&&d(document.activeElement).blur();if(!b.hasClass("selectBox-active")){b.addClass("selectBox-active");c.trigger("focus")}}).bind("blur.selectBox",
function(){if(b.hasClass("selectBox-active")){b.removeClass("selectBox-active");c.trigger("blur")}});d(window).data("selectBox-bindings")||d(window).data("selectBox-bindings",true).bind("scroll.selectBox",f.hideOnWindowScroll?this.hideMenus:d.noop).bind("resize.selectBox",this.hideMenus);c.attr("disabled")&&b.addClass("selectBox-disabled");c.bind("click.selectBox",function(i){b.focus();i.preventDefault()});if(e){a=this.getOptions("inline");b.append(a).data("selectBox-options",a).addClass("selectBox-inline selectBox-menuShowing").bind("keydown.selectBox",
function(i){h.handleKeyDown(i)}).bind("keypress.selectBox",function(i){h.handleKeyPress(i)}).bind("mousedown.selectBox",function(i){if(1===i.which){d(i.target).is("A.selectBox-inline")&&i.preventDefault();b.hasClass("selectBox-focus")||b.focus()}}).insertAfter(c);if(!c[0].style.height){e=c.attr("size")?parseInt(c.attr("size")):5;g=b.clone().removeAttr("id").css({position:"absolute",top:"-9999em"}).show().appendTo("body");g.find(".selectBox-options").html("<li><a>\u00a0</a></li>");var k=parseInt(g.find(".selectBox-options A:first").html("&nbsp;").outerHeight());
g.remove();b.height(k*e)}}else{e=d('<span class="selectBox-label" />');g=d('<span class="selectBox-arrow" />');e.attr("class",this.getLabelClass()).text(this.getLabelText());a=this.getOptions("dropdown");a.appendTo("BODY");b.data("selectBox-options",a).addClass("selectBox-dropdown").append(e).append(g).bind("mousedown.selectBox",function(i){if(1===i.which)if(b.hasClass("selectBox-menuShowing"))h.hideMenus();else{i.stopPropagation();a.data("selectBox-down-at-x",i.screenX).data("selectBox-down-at-y",
i.screenY);h.showMenu()}}).bind("keydown.selectBox",function(i){h.handleKeyDown(i)}).bind("keypress.selectBox",function(i){h.handleKeyPress(i)}).bind("open.selectBox",function(i,l){l&&l._selectBox===true||h.showMenu()}).bind("close.selectBox",function(i,l){l&&l._selectBox===true||h.hideMenus()}).insertAfter(c);g=b.width()-g.outerWidth()-(parseInt(e.css("paddingLeft"))||0)-(parseInt(e.css("paddingRight"))||0);e.width(g)}this.disableSelection(b);c.addClass("selectBox").data("selectBox-control",b).data("selectBox-settings",
f).hide()};j.prototype.getOptions=function(a){var c,b=d(this.selectElement),e=this;function f(h,k){h.children("OPTION, OPTGROUP").each(function(){if(d(this).is("OPTION"))d(this).length>0?e.generateOptions(d(this),k):k.append("<li>\u00a0</li>");else{var i=d('<li class="selectBox-optgroup" />');i.text(d(this).attr("label"));k.append(i);k=f(d(this),k)}});return k}switch(a){case "inline":c=d('<ul class="selectBox-options" />');c=f(b,c);c.find("A").bind("mouseover.selectBox",function(){e.addHover(d(this).parent())}).bind("mouseout.selectBox",
function(){e.removeHover(d(this).parent())}).bind("mousedown.selectBox",function(h){if(1===h.which){h.preventDefault();b.selectBox("control").hasClass("selectBox-active")||b.selectBox("control").focus()}}).bind("mouseup.selectBox",function(h){if(1===h.which){e.hideMenus();e.selectOption(d(this).parent(),h)}});this.disableSelection(c);return c;case "dropdown":c=d('<ul class="selectBox-dropdown-menu selectBox-options" />');c=f(b,c);c.data("selectBox-select",b).css("display","none").appendTo("BODY").find("A").bind("mousedown.selectBox",
function(h){if(h.which===1){h.preventDefault();if(h.screenX===c.data("selectBox-down-at-x")&&h.screenY===c.data("selectBox-down-at-y")){c.removeData("selectBox-down-at-x").removeData("selectBox-down-at-y");e.hideMenus()}}}).bind("mouseup.selectBox",function(h){if(1===h.which)if(!(h.screenX===c.data("selectBox-down-at-x")&&h.screenY===c.data("selectBox-down-at-y"))){c.removeData("selectBox-down-at-x").removeData("selectBox-down-at-y");e.selectOption(d(this).parent());e.hideMenus()}}).bind("mouseover.selectBox",
function(){e.addHover(d(this).parent())}).bind("mouseout.selectBox",function(){e.removeHover(d(this).parent())});a=b.attr("class")||"";if(""!==a){a=a.split(" ");for(var g in a)c.addClass(a[g]+"-selectBox-dropdown-menu")}this.disableSelection(c);return c}};j.prototype.getLabelClass=function(){var a=d(this.selectElement).find("OPTION:selected");return("selectBox-label "+(a.attr("class")||"")).replace(/\s+$/,"")};j.prototype.getLabelText=function(){var a=d(this.selectElement).find("OPTION:selected");
return a.text()||"\u00a0"};j.prototype.setLabel=function(){var a=d(this.selectElement);(a=a.data("selectBox-control"))&&a.find(".selectBox-label").attr("class",this.getLabelClass()).text(this.getLabelText())};j.prototype.destroy=function(){var a=d(this.selectElement),c=a.data("selectBox-control");if(c){var b=c.data("selectBox-options");b.remove();c.remove();a.removeClass("selectBox").removeData("selectBox-control").data("selectBox-control",null).removeData("selectBox-settings").data("selectBox-settings",
null).show()}};j.prototype.refresh=function(){var a=d(this.selectElement);a=a.data("selectBox-control");var c=a.hasClass("selectBox-dropdown")?"dropdown":"inline",b;a.data("selectBox-options").remove();b=this.getOptions(c);a.data("selectBox-options",b);switch(c){case "inline":a.append(b);break;case "dropdown":this.setLabel();d("BODY").append(b);break}"dropdown"===c&&a.hasClass("selectBox-menuShowing")&&this.showMenu()};j.prototype.showMenu=function(){var a=this,c=d(this.selectElement),b=c.data("selectBox-control"),
e=c.data("selectBox-settings"),f=b.data("selectBox-options");if(b.hasClass("selectBox-disabled"))return false;this.hideMenus();var g=parseInt(b.css("borderBottomWidth"))||0,h=parseInt(b.css("borderTopWidth"))||0,k=b.offset(),i=e.topPositionCorrelation?e.topPositionCorrelation:0,l=e.bottomPositionCorellation?e.bottomPositionCorellation:0,t=f.outerHeight(),r=b.outerHeight(),m=parseInt(f.css("max-height")),n=d(window).scrollTop(),o=k.top-n,q=d(window).height()-(o+r);g=(n=o>q)?k.top-t+h+i:k.top+r-g-l;
if(o<m&&q<m)if(n){h=m-(o-5);f.css({"max-height":m-h+"px"});g+=h}else{h=m-(q-5);f.css({"max-height":m-h+"px"})}f.data("posTop",n);f.width(b.innerWidth()).css({top:g,left:b.offset().left}).addClass("selectBox-options selectBox-options-"+(n?"top":"bottom"));if(c.triggerHandler("beforeopen"))return false;function p(){c.triggerHandler("open",{_selectBox:true})}switch(e.menuTransition){case "fade":f.fadeIn(e.menuSpeed,p);break;case "slide":f.slideDown(e.menuSpeed,p);break;default:f.show(e.menuSpeed,p);
break}e.menuSpeed||p();e=f.find(".selectBox-selected:first");this.keepOptionInView(e,true);this.addHover(e);b.addClass("selectBox-menuShowing selectBox-menuShowing-"+(n?"top":"bottom"));d(document).bind("mousedown.selectBox",function(s){if(1===s.which)d(s.target).parents().andSelf().hasClass("selectBox-options")||a.hideMenus()})};j.prototype.hideMenus=function(){if(d(".selectBox-dropdown-menu:visible").length!==0){d(document).unbind("mousedown.selectBox");d(".selectBox-dropdown-menu").each(function(){var a=
d(this),c=a.data("selectBox-select"),b=c.data("selectBox-control"),e=c.data("selectBox-settings"),f=a.data("posTop");if(c.triggerHandler("beforeclose"))return false;function g(){c.triggerHandler("close",{_selectBox:true})}if(e){switch(e.menuTransition){case "fade":a.fadeOut(e.menuSpeed,g);break;case "slide":a.slideUp(e.menuSpeed,g);break;default:a.hide(e.menuSpeed,g);break}e.menuSpeed||g();b.removeClass("selectBox-menuShowing selectBox-menuShowing-"+(f?"top":"bottom"))}else{d(this).hide();d(this).triggerHandler("close",
{_selectBox:true});d(this).removeClass("selectBox-menuShowing selectBox-menuShowing-"+(f?"top":"bottom"))}a.css("max-height","");a.removeClass("selectBox-options-"+(f?"top":"bottom"));a.data("posTop",false)})}};j.prototype.selectOption=function(a,c){var b=d(this.selectElement);a=d(a);var e=b.data("selectBox-control");b.data("selectBox-settings");if(e.hasClass("selectBox-disabled"))return false;if(0===a.length||a.hasClass("selectBox-disabled"))return false;if(b.attr("multiple"))if(c.shiftKey&&e.data("selectBox-last-selected")){a.toggleClass("selectBox-selected");
c=a.index()>e.data("selectBox-last-selected").index()?a.siblings().slice(e.data("selectBox-last-selected").index(),a.index()):a.siblings().slice(a.index(),e.data("selectBox-last-selected").index());c=c.not(".selectBox-optgroup, .selectBox-disabled");a.hasClass("selectBox-selected")?c.addClass("selectBox-selected"):c.removeClass("selectBox-selected")}else if(this.isMac&&c.metaKey||!this.isMac&&c.ctrlKey)a.toggleClass("selectBox-selected");else{a.siblings().removeClass("selectBox-selected");a.addClass("selectBox-selected")}else{a.siblings().removeClass("selectBox-selected");
a.addClass("selectBox-selected")}e.hasClass("selectBox-dropdown")&&e.find(".selectBox-label").text(a.text());var f=0,g=[];if(b.attr("multiple"))e.find(".selectBox-selected A").each(function(){g[f++]=d(this).attr("rel")});else g=a.find("A").attr("rel");e.data("selectBox-last-selected",a);if(b.val()!==g){b.val(g);this.setLabel();b.trigger("change")}return true};j.prototype.addHover=function(a){a=d(a);var c=d(this.selectElement);c=c.data("selectBox-control");c=c.data("selectBox-options");c.find(".selectBox-hover").removeClass("selectBox-hover");
a.addClass("selectBox-hover")};j.prototype.getSelectElement=function(){return this.selectElement};j.prototype.removeHover=function(a){a=d(a);a=d(this.selectElement);a=a.data("selectBox-control");a=a.data("selectBox-options");a.find(".selectBox-hover").removeClass("selectBox-hover")};j.prototype.keepOptionInView=function(a,c){if(!(!a||a.length===0)){var b=d(this.selectElement);b=b.data("selectBox-control");var e=b.data("selectBox-options");b=b.hasClass("selectBox-dropdown")?e:e.parent();e=parseInt(a.offset().top-
b.position().top);var f=parseInt(e+a.outerHeight());if(c)b.scrollTop(a.offset().top-b.offset().top+b.scrollTop()-b.height()/2);else{e<0&&b.scrollTop(a.offset().top-b.offset().top+b.scrollTop());f>b.height()&&b.scrollTop(a.offset().top+a.outerHeight()-b.offset().top+b.scrollTop()-b.height())}}};j.prototype.handleKeyDown=function(a){var c=d(this.selectElement),b=c.data("selectBox-control"),e=b.data("selectBox-options");c=c.data("selectBox-settings");var f=0,g=0;if(!b.hasClass("selectBox-disabled"))switch(a.keyCode){case 8:a.preventDefault();
this.typeSearch="";break;case 9:case 27:this.hideMenus();this.removeHover();break;case 13:if(b.hasClass("selectBox-menuShowing")){this.selectOption(e.find("LI.selectBox-hover:first"),a);b.hasClass("selectBox-dropdown")&&this.hideMenus()}else this.showMenu();break;case 38:case 37:a.preventDefault();if(b.hasClass("selectBox-menuShowing")){b=e.find(".selectBox-hover").prev("LI");f=e.find("LI:not(.selectBox-optgroup)").length;for(g=0;b.length===0||b.hasClass("selectBox-disabled")||b.hasClass("selectBox-optgroup");){b=
b.prev("LI");if(b.length===0)b=c.loopOptions?e.find("LI:last"):e.find("LI:first");if(++g>=f)break}this.addHover(b);this.selectOption(b,a);this.keepOptionInView(b)}else this.showMenu();break;case 40:case 39:a.preventDefault();if(b.hasClass("selectBox-menuShowing")){b=e.find(".selectBox-hover").next("LI");f=e.find("LI:not(.selectBox-optgroup)").length;for(g=0;0===b.length||b.hasClass("selectBox-disabled")||b.hasClass("selectBox-optgroup");){b=b.next("LI");if(b.length===0)b=c.loopOptions?e.find("LI:first"):
e.find("LI:last");if(++g>=f)break}this.addHover(b);this.selectOption(b,a);this.keepOptionInView(b)}else this.showMenu();break}};j.prototype.handleKeyPress=function(a){var c=d(this.selectElement);c=c.data("selectBox-control");var b=c.data("selectBox-options"),e=this;if(!c.hasClass("selectBox-disabled"))switch(a.keyCode){case 9:case 27:case 13:case 38:case 37:case 40:case 39:break;default:c.hasClass("selectBox-menuShowing")||this.showMenu();a.preventDefault();clearTimeout(this.typeTimer);this.typeSearch+=
String.fromCharCode(a.charCode||a.keyCode);b.find("A").each(function(){if(d(this).text().substr(0,e.typeSearch.length).toLowerCase()===e.typeSearch.toLowerCase()){e.addHover(d(this).parent());e.selectOption(d(this).parent(),a);e.keepOptionInView(d(this).parent());return false}});this.typeTimer=setTimeout(function(){e.typeSearch=""},1000);break}};j.prototype.enable=function(){var a=d(this.selectElement);a.attr("disabled",false);(a=a.data("selectBox-control"))&&a.removeClass("selectBox-disabled")};
j.prototype.disable=function(){var a=d(this.selectElement);a.attr("disabled",true);(a=a.data("selectBox-control"))&&a.addClass("selectBox-disabled")};j.prototype.setValue=function(a){var c=d(this.selectElement);c.val(a);a=c.val();if(null===a){a=c.children().first().val();c.val(a)}var b=c.data("selectBox-control");if(b){var e=c.data("selectBox-settings");b=b.data("selectBox-options");this.setLabel();b.find(".selectBox-selected").removeClass("selectBox-selected");b.find("A").each(function(){if(typeof a===
"object")for(var f=0;f<a.length;f++)d(this).attr("rel")==a[f]&&d(this).parent().addClass("selectBox-selected");else d(this).attr("rel")==a&&d(this).parent().addClass("selectBox-selected")});e.change&&e.change.call(c)}};j.prototype.setOptions=function(a){var c=d(this.selectElement),b=c.data("selectBox-control");switch(typeof a){case "string":c.html(a);break;case "object":c.html("");for(var e in a)if(a[e]!==null)if(typeof a[e]==="object"){var f=d('<optgroup label="'+e+'" />');for(var g in a[e])f.append('<option value="'+
g+'">'+a[e][g]+"</option>");c.append(f)}else{f=d('<option value="'+e+'">'+a[e]+"</option>");c.append(f)}break}b&&this.refresh()};j.prototype.disableSelection=function(a){d(a).css("MozUserSelect","none").bind("selectstart",function(c){c.preventDefault()})};j.prototype.generateOptions=function(a,c){var b=d("<li />"),e=d("<a />");b.addClass(a.attr("class"));b.data(a.data());e.attr("rel",a.val()).text(a.text());b.append(e);a.attr("disabled")&&b.addClass("selectBox-disabled");a.attr("selected")&&b.addClass("selectBox-selected");
c.append(b)};d.extend(d.fn,{selectBox:function(a,c){var b;switch(a){case "control":return d(this).data("selectBox-control");case "settings":if(!c)return d(this).data("selectBox-settings");d(this).each(function(){d(this).data("selectBox-settings",d.extend(true,d(this).data("selectBox-settings"),c))});break;case "options":if(undefined===c)return d(this).data("selectBox-control").data("selectBox-options");d(this).each(function(){if(b=d(this).data("selectBox"))b.setOptions(c)});break;case "value":if(undefined===
c)return d(this).val();d(this).each(function(){if(b=d(this).data("selectBox"))b.setValue(c)});break;case "refresh":d(this).each(function(){if(b=d(this).data("selectBox"))b.refresh()});break;case "enable":d(this).each(function(){if(b=d(this).data("selectBox"))b.enable(this)});break;case "disable":d(this).each(function(){if(b=d(this).data("selectBox"))b.disable()});break;case "destroy":d(this).each(function(){if(b=d(this).data("selectBox")){b.destroy();d(this).data("selectBox",null)}});break;case "instance":return d(this).data("selectBox");
default:d(this).each(function(e,f){d(f).data("selectBox")||d(f).data("selectBox",new j(f,a))});break}return d(this)}})})(jQuery);
